# Harbor Helm Values pour Home Kluster (AMD64)
# Chart: harbor v1.17.1
# TLS désactivé car on passe par un tunnel Cloudflare

ipFamily:
  ipv6:
    enabled: false

expose:
  type: ingress
  tls:
    enabled: false
  ingress:
    hosts:
      core: harbor.valab.top
    controller: default
    className: "traefik"
    annotations: {}

externalURL: https://harbor.valab.top

# Admin password - TODO: utiliser un secret
existingSecretAdminPassword: harbor-admin-secret
existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD
# harborAdminPassword: Harbor12345

persistence:
  enabled: true
  resourcePolicy: "keep"
  persistentVolumeClaim:
    registry:
      # Stockage bulk sur ZFS tank_data (HDD) - plus de capacité
      storageClass: "nfs-csi-hdd"
      size: 50Gi
    jobservice:
      jobLog:
        storageClass: "nfs-csi-nvme"
        size: 256Mi
    redis:
      # Utilisation de local-path pour Redis (cache) pour éviter tout problème avec NFS
      # Les données ne seront pas répliquées si le pod change de nœud, mais c'est un cache.
      storageClass: "local-path"
      size: 512Mi

# Components configuration
portal:
  resources:
    limits:
      memory: 128Mi
    requests:
      memory: 64Mi
      cpu: 10m

core:
  startupProbe:
    initialDelaySeconds: 15
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 128Mi
      cpu: 20m

jobservice:
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 64Mi
      cpu: 20m

registry:
  registry:
    resources:
      limits:
        memory: 256Mi
      requests:
        memory: 64Mi
        cpu: 20m
  controller:
    resources:
      limits:
        memory: 128Mi
      requests:
        memory: 32Mi
        cpu: 10m

trivy:
  enabled: false

# Base de données externe sur LXC PostgreSQL
database:
  type: external
  external:
    host: 10.0.0.12
    port: 5432
    existingSecret: harbor-pg-secret
    coreDatabase: harbor_db
    username: harbor_user

# Redis interne (pas de persistance - cache seulement)
redis:
  internal:
    resources:
      limits:
        memory: 128Mi
      requests:
        memory: 32Mi
        cpu: 10m

exporter:
  resources:
    limits:
      memory: 128Mi
    requests:
      memory: 64Mi
      cpu: 10m
