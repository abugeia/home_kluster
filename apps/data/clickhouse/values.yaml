# Configuration pour le chart Altinity Clickhouse
# Ce chart installe l'opérateur ET le cluster via une ressource ClickHouseInstallation (CHI)

operator:
  enabled: false # Déjà installé manuellement pour débloquer les CRD

clickhouse:
  install: true
  # Définition de la ressource ClickHouseInstallation (CHI)
  spec:
    configuration:
      users:
        admin/password: "admin"
      settings:
        logger/level: "information"
        max_connections: 1024
    
    defaults:
      templates:
        dataVolumeClaimTemplate: data-volume
        logVolumeClaimTemplate: log-volume
        podTemplate: pod-template

    templates:
      # Note: Le chart Altinity attend 'templates' et non 'tpls' dans certains contextes, 
      # et les éléments peuvent être des listes ou des objets selon la version.
      dataVolumeClaimTemplates:
        - name: data-volume
          spec:
            storageClassName: nfs-csi-nvme
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
      
      logVolumeClaimTemplates:
        - name: log-volume
          spec:
            storageClassName: nfs-csi-nvme
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 5Gi

      podTemplates:
        - name: pod-template
          spec:
            containers:
              - name: clickhouse
                image: public.ecr.aws/altinity/clickhouse-server:23.8.9.54-altinity
                resources:
                  requests:
                    memory: "1Gi"
                    cpu: "500m"
                  limits:
                    memory: "2Gi"
                    cpu: "1"

    layout:
      shardsCount: 1
      replicasCount: 1
