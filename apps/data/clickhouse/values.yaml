# Configuration GitOps pour le chart Altinity Clickhouse v0.3.8
# Ce chart gère l'installation de l'opérateur et du cluster via des paramètres plats.

operator:
  enabled: true
  # L'opérateur sera installé dans le namespace de destination (data) fixé par ArgoCD.

clickhouse:
  # Nombre de réplicas pour le cluster Clickhouse
  replicasCount: 1
  
  # Configuration de l'image (utilisant ECR pour éviter les quotas Docker Hub)
  image:
    repository: public.ecr.aws/altinity/altinity/clickhouse-server
    tag: "23.8.15.35"

  # Configuration de la persistence
  persistence:
    enabled: true
    size: 20Gi
    storageClass: "nfs-csi-nvme"
    accessMode: ReadWriteOnce
    logs:
      enabled: true
      size: 5Gi
      storageClass: "nfs-csi-nvme"
      accessMode: ReadWriteOnce

  # Paramètres de configuration Clickhouse (format dictionnaire)
  settings:
    logger/level: "information"
    max_connections: 1024
    
  # ==========================================
  # Configuration des Utilisateurs
  # ==========================================
  users:
    # Admin root
    - name: admin
      k8s_secret_name: "clickhouse-auth"
      k8s_secret_key: "admin-password"
      networks:
        ip: "::/0" # Autoriser toutes les IPs (Cluster interne)

    # User pour l'ingestion (DLT)
    - name: dataloader
      k8s_secret_name: "clickhouse-auth"
      k8s_secret_key: "dataloader-password"
      networks:
        ip: "::/0"
      profile: "default"
      access_management: "1" # Droit de créer la DB raw_data

    # User pour la visualisation (Superset)
    - name: superset
      k8s_secret_name: "clickhouse-auth"
      k8s_secret_key: "superset-password"
      networks:
        ip: "::/0"
      profile: "readonly"

  # Profils personnalisés
  profiles:
    readonly/readonly: "1"

