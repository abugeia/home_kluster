# Configuration pour le chart Altinity Clickhouse
# Ce chart installe l'opérateur ET le cluster via une ressource ClickHouseInstallation (CHI)

operator:
  enabled: true
  # L'opérateur sera installé dans le même namespace par défaut (data)

clickhouse:
  install: true
  # Définition de la ressource ClickHouseInstallation
  spec:
    configuration:
      users:
        # Configuration utilisateur si nécessaire, sinon utilise les défauts
        admin/password: "admin" # À changer en prod
      settings:
        # Paramètres globaux Clickhouse
        logger/level: "information"
        max_connections: 1024
    
    defaults:
      templates:
        dataVolumeClaimTemplate: data-volume
        logVolumeClaimTemplate: log-volume
        podTemplate: pod-template

    tpls:
      # Template pour les volumes de données
      dataVolumeClaimTemplates:
        - name: data-volume
          spec:
            storageClassName: nfs-csi-nvme
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 20Gi
      
      # Template pour les logs
      logVolumeClaimTemplates:
        - name: log-volume
          spec:
            storageClassName: nfs-csi-nvme
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 5Gi

      # Template pour les Pods
      podTemplates:
        - name: pod-template
          spec:
            containers:
              - name: clickhouse
                image: public.ecr.aws/altinity/clickhouse-server:23.8.9.54-altinity
                resources:
                  requests:
                    memory: "1Gi"
                    cpu: "500m"
                  limits:
                    memory: "2Gi"
                    cpu: "1"

    layout:
      shardsCount: 1
      replicasCount: 1
