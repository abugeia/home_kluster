# Homepage Helm Values
# Chart: jameswynn/homepage (https://jameswynn.github.io/helm-charts)

image:
  repository: ghcr.io/gethomepage/homepage
  tag: v1.8.0
  pullPolicy: IfNotPresent

# Environment variables
env:
  - name: HOMEPAGE_ALLOWED_HOSTS
    value: "home.valab.top,homepage.admin.svc.cluster.local"

# Activer le RBAC pour que Homepage puisse scanner le cluster (Pods/Ingress/etc)
serviceAccount:
  create: true
  name: homepage

rbac:
  create: true
  # Force ClusterRole creation to read all resources cross-namespace
  rules:
    - apiGroups: [""]
      resources: ["pods", "nodes", "services", "endpoints"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["networking.k8s.io", "extensions"]
      resources: ["ingresses"]
      verbs: ["get", "list", "watch"]
  
# Ingress pour accès externe
ingress:
  main:
    enabled: true
    ingressClassName: traefik
    annotations:
      # Protection via TinyAuth existant
      traefik.ingress.kubernetes.io/router.middlewares: security-tinyauth-protect@kubernetescrd
    hosts:
      - host: home.valab.top
        paths:
          - path: /
            pathType: Prefix

# Configuration de l'application
config:
  settings:
    title: Home Kluster
    background:
      image: https://images.unsplash.com/photo-1502657877623-f66bf489d236?auto=format&fit=crop&w=2000&q=80
      opacity: 0.5
    theme: dark
    color: slate
    layout:
      Media:
        style: row
        columns: 4
      Storage:
        style: row
        columns: 4
      Admin:
        style: row
        columns: 4
    
    # Activation du service discovery Kubernetes
    kubernetes:
      mode: cluster

  # Widgets affichés en haut de la page
  widgets:
    - resources:
        cpu: true
        memory: true
        disk: /
    # - kubernetes:
    #     cluster:
    #       show: true
    #       cpu: true
    #       memory: true
    #       showLabel: true
    #       label: "Home Kluster"
    - search:
        provider: google
        target: _blank

  # Groupes de services (exemple initial, sera enrichi via annotations sur les autres apps)
  services: []
